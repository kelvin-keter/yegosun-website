{% extends "base.html" %}
{% block title %}Solar Savings Calculator{% endblock %}

{% block content %}
<div class="bg-dark text-white py-5 position-relative" style="background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?q=80&w=1600&auto=format&fit=crop'); background-size: cover; background-position: center;">
    <div class="container text-center position-relative" style="z-index: 2;">
        <h6 class="text-warning fw-bold text-uppercase tracking-wide mb-3">ROI Estimator</h6>
        <h1 class="display-4 fw-extrabold">Calculate Your Savings</h1>
        <p class="lead text-white-50">See how much money you are losing to the grid every year.</p>
    </div>
</div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="card-body p-5">
                    
                    <div id="calculatorInput">
                        <h3 class="fw-bold text-center mb-4">Enter Your Monthly Bill</h3>
                        
                        <div class="mb-4">
                            <label class="form-label text-muted fw-bold small">AVERAGE MONTHLY ELECTRICITY BILL (KES)</label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text bg-light border-0 fw-bold">KES</span>
                                <input type="number" id="billAmount" class="form-control bg-light border-0 fw-bold" placeholder="e.g. 15000">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label text-muted fw-bold small">PROPERTY TYPE</label>
                            <div class="row g-3">
                                <div class="col-6">
                                    <input type="radio" class="btn-check" name="propertyType" id="home" checked>
                                    <label class="btn btn-outline-success w-100 py-3 fw-bold" for="home">
                                        <i class="fa-solid fa-home me-2"></i> Home
                                    </label>
                                </div>
                                <div class="col-6">
                                    <input type="radio" class="btn-check" name="propertyType" id="business">
                                    <label class="btn btn-outline-warning w-100 py-3 fw-bold" for="business">
                                        <i class="fa-solid fa-building me-2"></i> Business
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button onclick="calculateSolar()" class="btn btn-dark w-100 btn-lg fw-bold py-3">CALCULATE SAVINGS</button>
                    </div>

                    <div id="calculatorResult" class="d-none text-center animate-fade-in">
                        <div class="mb-4">
                            <span class="badge bg-success text-white px-3 py-2 rounded-pill mb-3">ESTIMATED RESULTS</span>
                            <h2 class="fw-extrabold mb-1">KES <span id="annualSavings" class="text-success">0</span></h2>
                            <p class="text-muted small fw-bold text-uppercase">Your Estimated Annual Savings</p>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="p-3 bg-light rounded-3 border">
                                    <h5 class="fw-bold mb-0 text-dark"><span id="systemSize">0</span> kW</h5>
                                    <small class="text-muted">Recommended System Size</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3 bg-light rounded-3 border">
                                    <h5 class="fw-bold mb-0 text-dark"><span id="panelsCount">0</span></h5>
                                    <small class="text-muted">Approx. Panels Needed</small>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info border-0 d-flex align-items-center mb-4" role="alert">
                            <i class="fa-solid fa-circle-info me-3 fa-lg"></i>
                            <div class="text-start small">
                                This is an estimate based on average Kenyan sun-hours (4.5h/day) and KPLC rates.
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <a href="{{ url_for('contact') }}" class="btn btn-warning btn-lg fw-bold shadow-sm">Get Official Quote</a>
                            <button onclick="resetCalculator()" class="btn btn-outline-secondary fw-bold">Calculate Again</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateSolar() {
        // 1. Get Input
        let bill = document.getElementById('billAmount').value;
        
        // Validation
        if (!bill || bill <= 0) {
            alert("Please enter a valid bill amount.");
            return;
        }

        // 2. Constants for Kenya Context
        const costPerUnit = 28; // Avg KES per kWh (blended rate)
        const peakSunHours = 4.5; // Conservative average for Nairobi/Juja
        const panelWattage = 550; // Standard modern panel size
        const efficiencyLoss = 1.3; // Factor for system losses

        // 3. The Math
        let monthlyUnits = bill / costPerUnit;
        let dailyUnits = monthlyUnits / 30;
        let requiredSizeKW = (dailyUnits * efficiencyLoss) / peakSunHours;
        
        // Rounding
        let finalSize = Math.ceil(requiredSizeKW * 2) / 2; // Round to nearest 0.5
        if (finalSize < 3) finalSize = 3; // Minimum viable hybrid system usually 3kW

        let numPanels = Math.ceil((finalSize * 1000) / panelWattage);
        
        // Savings (Assuming 90% offset)
        let monthlySavings = bill * 0.90;
        let yearlySavings = monthlySavings * 12;

        // 4. Update UI
        document.getElementById('annualSavings').innerText = yearlySavings.toLocaleString();
        document.getElementById('systemSize').innerText = finalSize;
        document.getElementById('panelsCount').innerText = numPanels;

        // 5. Show Results
        document.getElementById('calculatorInput').classList.add('d-none');
        document.getElementById('calculatorResult').classList.remove('d-none');
    }

    function resetCalculator() {
        document.getElementById('calculatorInput').classList.remove('d-none');
        document.getElementById('calculatorResult').classList.add('d-none');
        document.getElementById('billAmount').value = '';
    }
</script>
{% endblock %}